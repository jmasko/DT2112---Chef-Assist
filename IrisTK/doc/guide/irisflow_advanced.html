<!DOCTYPE html>
<html class="no-js" lang="en" > 

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>IrisTK</title>
  <link rel="stylesheet" href="css/foundation.css">
  <link rel="stylesheet" href="css/pandoc.css">
  <script src="js/vendor/custom.modernizr.js"></script>
</head>
<body>

	<div class="row">
		<div class="large-12 columns">
			<h1><a href="index.html">IrisTK</a></h1>
			<p class="tagline">Java-based dialogue system framework</p>
			<hr/>
		</div>
	</div>

	<div class="row">
	
		<div class="large-8 columns">
			<h2 id="irisflow-advanced-topics">IrisFlow: Advanced topics</h2>
<h3 id="re-usable-flows">Re-usable Flows</h3>
<p>You have probably already seen how states from one flow (such as &quot;say&quot; and &quot;listen&quot; in the re-usable flow iristk.flow.DialogFlow) can be called from another flow. By placing these states in separate flows, they do not have to be re-implemented. This way, you can create a library of useful flows and states.</p>
<p>As an example of re-usable flows, we can start with iristk/flow/DialogFlow.xml. In order to make the &quot;listen&quot; state accessible from another flow, it has to be made public:</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;state</span><span class="ot"> id=</span><span class="st">&quot;listen&quot;</span><span class="ot"> public=</span><span class="st">&quot;true&quot;</span><span class="ot"> static=</span><span class="st">&quot;true&quot;</span><span class="kw">&gt;</span></code></pre>
<p>In this case, we have also declared the state &quot;static&quot;, which means that the state can be called without a reference to a flow instance. This corresponds to the notion of static methods and classes in Java. In order to call this state from another flow, we can simple make a reference to it like this:</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;call</span><span class="ot"> state=</span><span class="st">&quot;iristk.flow.DialogFlow.listen&quot;</span><span class="kw">/&gt;</span></code></pre>
<h3 id="custom-tags">Custom tags</h3>
<p>As you probably have seen, there is also a more convenient way of calling states, using custom tags:</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;dialog:listen/&gt;</span></code></pre>
<p>For this to work, we have to associate the &quot;dialog&quot; prefix to the iristk.flow.DialogFlow class, using XML namespaces:</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;flow</span><span class="ot"> name=</span><span class="st">&quot;ChessFlow&quot;</span> 
<span class="ot">      xmlns:dialog=</span><span class="st">&quot;iristk.flow.DialogFlow&quot;</span> <span class="er">...</span></code></pre>
<p>When compiling a flow with public states, the compiler will also produce an XML Schema (such as DialogFlow.xsd). This is useful for validating custom tags in the calling flow (their names and parameters). To link this Schema, place it in the same folder as your flow, and link it in the root element (in addition to flow.xsd):</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;flow</span><span class="ot"> name=</span><span class="st">&quot;ChessFlow&quot;</span> 
<span class="ot">      xmlns:dialog=</span><span class="st">&quot;iristk.flow.DialogFlow&quot;</span> 
<span class="ot">      xmlns:xsi=</span><span class="st">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="ot">      xsi:schemaLocation=</span><span class="st">&quot;iristk.flow flow.xsd iristk.flow.DialogFlow DialogFlow.xsd&quot;</span>
      <span class="er">...</span></code></pre>
<h3 id="flow-instances">Flow instances</h3>
<p>The examples above work fine when the states are declared static, and no flow instance is needed. However if the states we are calling need access to flow-level variables, they cannot be declared static. You may have seen an example of this in iristk/situated/SituatedDialogFlow.xml. If you examine it, you will see that a reference to a SystemAgent object is taken as a parameter:</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;flow</span><span class="ot"> name=</span><span class="st">&quot;SituatedDialogFlow&quot;</span><span class="ot"> package=</span><span class="st">&quot;iristk.situated&quot;</span>  
<span class="ot">    initial=</span><span class="st">&quot;Idle&quot;</span><span class="ot"> xmlns=</span><span class="st">&quot;iristk.flow&quot;</span><span class="ot"> xmlns:p=</span><span class="st">&quot;iristk.flow.param&quot;</span>
<span class="ot">    xmlns:xsi=</span><span class="st">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="ot">    xsi:schemaLocation=</span><span class="st">&quot;iristk.flow flow.xsd&quot;</span><span class="kw">&gt;</span>
    
    <span class="kw">&lt;param</span><span class="ot"> name=</span><span class="st">&quot;system&quot;</span><span class="ot"> type=</span><span class="st">&quot;SystemAgent&quot;</span><span class="kw">/&gt;</span></code></pre>
<p>If you examine the &quot;listen&quot; state in the same flow, you will see that this flow-level &quot;system&quot; parameter is referenced, which means this state cannot be declared static. Thus, in order to call this state from another flow, we need a reference to a SituatedDialogFlow object in the calling flow. This can either be a variable (&lt;var&gt;) or a parameter (&lt;param&gt;). If we look at the Quiz example app, we can see that it is passed as a parameter:</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;flow</span><span class="ot"> name=</span><span class="st">&quot;QuizFlow&quot;</span><span class="ot"> package=</span><span class="st">&quot;iristk.app.quiz&quot;</span> 
<span class="ot">    initial=</span><span class="st">&quot;Idle&quot;</span><span class="ot"> xmlns=</span><span class="st">&quot;iristk.flow&quot;</span>
<span class="ot">    xmlns:xsi=</span><span class="st">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="ot">    xmlns:p=</span><span class="st">&quot;iristk.flow.param&quot;</span>
<span class="ot">    xmlns:dialog=</span><span class="st">&quot;iristk.situated.SituatedDialogFlow&quot;</span>
<span class="ot">    xsi:schemaLocation=</span><span class="st">&quot;iristk.flow flow.xsd iristk.situated.SituatedDialogFlow SituatedDialogFlow.xsd&quot;</span><span class="kw">&gt;</span>
    
    <span class="kw">&lt;param</span><span class="ot"> name=</span><span class="st">&quot;questions&quot;</span><span class="ot"> type=</span><span class="st">&quot;QuestionSet&quot;</span><span class="kw">/&gt;</span>
    <span class="kw">&lt;param</span><span class="ot"> name=</span><span class="st">&quot;dialog&quot;</span><span class="ot"> type=</span><span class="st">&quot;iristk.situated.SituatedDialogFlow&quot;</span><span class="kw">/&gt;</span></code></pre>
<p>Now, it is very important that the name of the parameter (&quot;dialog&quot;) matches the namespace prefix (xmlns:dialog). Otherwise, the compiler will not understand which object reference to use, when the custom tag is used (&lt;dialog:listen/&gt;), and it will try to make a static reference (which will fail).</p>
<p>If you want to call a non-static state without using a custom tag, you have to use this special notation:</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;call</span><span class="ot"> state=</span><span class="st">&quot;dialog#listen&quot;</span><span class="kw">/&gt;</span></code></pre>
<p>If you want to use custom tags to call states in the same flow instance, you can use the special namespace prefix &quot;this&quot;:</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;flow</span><span class="ot"> name=</span><span class="st">&quot;ChessFlow&quot;</span> 
<span class="ot">      package=</span><span class="st">&quot;iristk.app.chess&quot;</span>
<span class="ot">      xmlns:this=</span><span class="st">&quot;iristk.app.chess.ChessFlow&quot;</span> <span class="er">...</span><span class="kw">&gt;</span></code></pre>
		
		</div>

		<div class="large-4 columns">
			<h3>Guide to IrisTK</h3>
			
			<div class="section-container accordion" data-section="accordion">
				
				<section><p class="title" data-section-title><a href="#">Getting started</a></p><div class="content" data-section-content><ul class="side-nav"><li><a href="overview.html">Overview of IrisTK</a></li><li><a href="installation.html">Installation</a></li><li><a href="develop_in_eclipse.html">Develop in Eclipse</a></li><li><a href="tutorial_first_app.html">Tutorial 1: Your first application</a></li><li><a href="tutorial_sitint.html">Tutorial 2: Situated interaction</a></li><li><a href="tutorial_semantics.html">Tutorial 3: Semantics and dialog</a></li></ul></div></section><section><p class="title" data-section-title><a href="#">System, modules and events</a></p><div class="content" data-section-content><ul class="side-nav"><li><a href="system_overview.html">System and Events</a></li><li><a href="events.html">Standardized Events</a></li><li><a href="creating_new_modules.html">Creating new modules</a></li><li><a href="distributed_systems.html">Distributed systems</a></li></ul></div></section><section class="active"><p class="title" data-section-title><a href="#">IrisFlow</a></p><div class="content" data-section-content><ul class="side-nav"><li><a href="irisflow_overview.html">IrisFlow overview</a></li><li><a href="irisflow_reference.html">IrisFlow reference</a></li><li class="active"><a href="irisflow_advanced.html">Advanced topics</a></li></ul></div></section><section><p class="title" data-section-title><a href="#">Reference</a></p><div class="content" data-section-content><ul class="side-nav"><li><a href="microphones.html">Microphones</a></li><li><a href="furhat.html">Furhat robot head</a></li><li><a href="gestures.html">Facial gestures</a></li><li><a href="cereproc.html">Cereproc TTS</a></li><li><a href="../javadoc/index.html">Javadoc</a></li></ul></div></section>		
			  
			</div>
			
		</div>
	</div>
	
	
	<div class="row">
		<div class="large-12 columns">
			<hr/>
			<p>Copyright &copy; Gabriel Skantze, 2013-</p>
		</div>
	</div>

  <script>
  document.write('<script src=' +
  ('__proto__' in {} ? 'js/vendor/zepto' : 'js/vendor/jquery') +
  '.js><\/script>')
  </script>
  
  <script src="js/foundation.min.js"></script>

  <script src="js/foundation/foundation.js"></script>
  
  <script src="js/foundation/foundation.alerts.js"></script>
  
  <script src="js/foundation/foundation.clearing.js"></script>
  
  <script src="js/foundation/foundation.cookie.js"></script>
  
  <script src="js/foundation/foundation.dropdown.js"></script>
  
  <script src="js/foundation/foundation.forms.js"></script>
  
  <script src="js/foundation/foundation.joyride.js"></script>
  
  <script src="js/foundation/foundation.magellan.js"></script>
  
  <script src="js/foundation/foundation.orbit.js"></script>
  
  <script src="js/foundation/foundation.reveal.js"></script>
  
  <script src="js/foundation/foundation.section.js"></script>
  
  <script src="js/foundation/foundation.tooltips.js"></script>
  
  <script src="js/foundation/foundation.topbar.js"></script>
  
  <script src="js/foundation/foundation.interchange.js"></script>
  
  <script src="js/foundation/foundation.placeholder.js"></script>
  
  <script src="js/foundation/foundation.abide.js"></script>

  
  
  <script>
    $(document).foundation();
  </script>
</body>
</html>