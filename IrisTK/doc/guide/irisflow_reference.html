<!DOCTYPE html>
<html class="no-js" lang="en" > 

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>IrisTK</title>
  <link rel="stylesheet" href="css/foundation.css">
  <link rel="stylesheet" href="css/pandoc.css">
  <script src="js/vendor/custom.modernizr.js"></script>
</head>
<body>

	<div class="row">
		<div class="large-12 columns">
			<h1><a href="index.html">IrisTK</a></h1>
			<p class="tagline">Java-based dialogue system framework</p>
			<hr/>
		</div>
	</div>

	<div class="row">
	
		<div class="large-8 columns">
			<h2 id="irisflow-reference">IrisFlow Reference</h2>
<h3 id="general-words-on-xml-and-java">General words on XML and Java</h3>
<p>Since the flow is written in XML which is then converted to Java, there are some things to look out for, but also some convenient tricks that the flow compiler allows for.</p>
<ul>
<li>XML does not allow less-than-brackets (&lt;) in expressions. Either reverse the expression (&gt; is allowed), or use the XML entity &amp;lt; instead. Although &quot;&gt;&quot; is allowed, it is also possible to use &amp;gt; instead.</li>
<li>Since &amp; is reserved for XML entities, you cannot directly write &amp;&amp; for Java &quot;and&quot;. You can write &amp;amp;&amp;amp;, but it doesn't look very pretty. Therefore the flow compiler allows you to use the words &quot;and&quot; and &quot;or&quot; which will be transformed to &amp;&amp; and ||.</li>
<li>Within XML attributes (such as cond), you cannot use double quotes (&quot;) for strings, use single quotes (') instead.</li>
<li>You cannot compare for example strings in Java with ==, you should use the equal() method instead. However, this may result in a NullPointerException if the object is null. There is a convenient way of testing equality that avoids this - you can use the static method eq(A,B) instead, which allows for null values.</li>
</ul>
<h3 id="defining-the-flow-flow">Defining the flow: &lt;flow&gt;</h3>
<p>The &lt;flow&gt; tag is the top-level element for the flow. It can have the following attributes:</p>
<table>
<tbody>
<tr class="odd">
<td align="left">name</td>
<td align="left">The name of the flow. It should match the name of the file (without the .xml extension).</td>
</tr>
<tr class="even">
<td align="left">package</td>
<td align="left">The Java package where the flow is located. Must match the folder structure.</td>
</tr>
<tr class="odd">
<td align="left">initial</td>
<td align="left">The initial state the flow should start in</td>
</tr>
</tbody>
</table>
<h3 id="importing-external-classes">Importing external classes</h3>
<p>Directly, after the &lt;flow&gt; top element, you can import external classes (translated to &quot;import&quot; in Java):</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="co">&lt;!-- Importing a class --&gt;</span>
<span class="kw">&lt;import</span><span class="ot"> class=</span><span class="st">&quot;java.util.List&quot;</span><span class="kw">/&gt;</span>
<span class="co">&lt;!-- Importing all classes in a package --&gt;</span>
<span class="kw">&lt;import</span><span class="ot"> class=</span><span class="st">&quot;java.util.*&quot;</span><span class="kw">/&gt;</span>
<span class="co">&lt;!-- Importing static methods --&gt;</span>
<span class="kw">&lt;import</span><span class="ot"> class=</span><span class="st">&quot;static java.lang.Math.*&quot;</span><span class="kw">/&gt;</span></code></pre>
<h3 id="defining-variables-var">Defining variables: &lt;var&gt;</h3>
<p>Variables can be declared on three levels: flow, state or as an action to assign a value.</p>
<p>The &lt;var&gt; tag contains the following attributes:</p>
<table>
<tbody>
<tr class="odd">
<td align="left">name</td>
<td align="left">The name of the variable</td>
</tr>
<tr class="even">
<td align="left">type</td>
<td align="left">The type of the variable (a Java class or primitive Java type, String if omitted)</td>
</tr>
<tr class="odd">
<td align="left">value</td>
<td align="left">An initial value for the variable (null if omitted)</td>
</tr>
</tbody>
</table>
<p>Flow variables can be accessed from outside the flow (in Java):</p>
<pre class="sourceCode java"><code class="sourceCode java">flow.<span class="fu">setChess</span>(chess);
flow.<span class="fu">getChess</span>();</code></pre>
<h3 id="defining-parameters-param">Defining parameters : &lt;param&gt;</h3>
<p>Parameters can be either flow-level or state-level. Parameters are also variables, but they are assigned when instantiating the flow or state.</p>
<p>The &lt;param&gt; tag contains the same attributes as the &lt;var&gt; tag (see above). The &quot;value&quot; attribute then defines the default value (which can be omitted).</p>
<p>How state-level parameters are used when calling or going to a state is described further down.</p>
<p>Flow-level parameters can be used to give the flow access to Java objects defined outside the flow, such as external flows or for querying or interacting with a back-end system. Here is an example from the Chess application:</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;flow</span><span class="ot"> name=</span><span class="st">&quot;ChessFlow&quot;</span> <span class="er">...</span><span class="kw">&gt;</span>

    <span class="kw">&lt;param</span><span class="ot"> name=</span><span class="st">&quot;chess&quot;</span><span class="ot"> type=</span><span class="st">&quot;ChessGame&quot;</span><span class="kw">/&gt;</span></code></pre>
<p>This way, the flow can access the &quot;chess&quot; object in for example &lt;exec&gt;, &lt;expr&gt; and &quot;cond&quot; attributes.</p>
<p>When declaring flow-level parameters, they are required in the flow constructor on the Java-side:</p>
<pre class="sourceCode java"><code class="sourceCode java">ChessGame chessGame = <span class="kw">new</span> <span class="fu">ChessGame</span>(system.<span class="fu">getGUI</span>());
flowModule = <span class="kw">new</span> <span class="fu">FlowModule</span>(<span class="kw">new</span> <span class="fu">ChessFlow</span>(chessGame));</code></pre>
<h3 id="defining-a-state-state">Defining a state: &lt;state&gt;</h3>
<p>The &lt;state&gt; tag may contain the following attributes:</p>
<table>
<tbody>
<tr class="odd">
<td align="left">id</td>
<td align="left">A unique name for the state</td>
</tr>
<tr class="even">
<td align="left">extends</td>
<td align="left">An extension of another state (see below)</td>
</tr>
<tr class="odd">
<td align="left">static</td>
<td align="left">Whether the state is static (Boolean, default false). Static states cannot access any flow variables or refer to non-static states.</td>
</tr>
<tr class="even">
<td align="left">public</td>
<td align="left">Whether the state is public (Boolean, default false). Public states can be accessed from external flows.</td>
</tr>
</tbody>
</table>
<p>By extending a state using extends, it is possible to define generic event handlers in one parent state and then reuse them in states that extend it. Thus each time an event is processed by the flow, first all event handlers of the leaf state are checked, then the event handlers of the parent state, and then the event handlers of that parent's state, and so on.</p>
<p>For the use of &quot;static&quot; and &quot;public&quot;, please refer to <a href="irisflow_advanced.html">Advanced Topics</a>.</p>
<p>States can also define parameters using &lt;param&gt;, as well as defining variables using &lt;var&gt;:</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;state</span><span class="ot"> id=</span><span class="st">&quot;Listening&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;param</span><span class="ot"> name=</span><span class="st">&quot;timeout&quot;</span><span class="ot"> type=</span><span class="st">&quot;int&quot;</span><span class="ot"> default=</span><span class="st">&quot;8000&quot;</span><span class="kw">/&gt;</span>
    <span class="kw">&lt;var</span><span class="ot"> name=</span><span class="st">&quot;speechStarted&quot;</span><span class="ot"> type=</span><span class="st">&quot;boolean&quot;</span><span class="ot"> value=</span><span class="st">&quot;false&quot;</span><span class="kw">/&gt;</span>
    <span class="kw">&lt;onentry&gt;</span>
        <span class="kw">&lt;send</span><span class="ot"> event=</span><span class="st">&quot;action.listen&quot;</span><span class="ot"> p:timeout=</span><span class="st">&quot;timeout&quot;</span><span class="kw">/&gt;</span>
    <span class="kw">&lt;/onentry&gt;</span>
    <span class="kw">&lt;onevent</span><span class="ot"> name=</span><span class="st">&quot;sense.speech.start&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;exec&gt;</span>speechStarted = true<span class="kw">&lt;/exec&gt;</span>
    <span class="kw">&lt;/onevent&gt;</span>
    ...
<span class="kw">&lt;/state&gt;</span>    </code></pre>
<h3 id="event-handler-onevent">Event handler: &lt;onevent&gt;</h3>
<p>The &lt;onevent&gt; event handler is used to catch local or global events. It can take two attributes:</p>
<table>
<tbody>
<tr class="odd">
<td align="left">name</td>
<td align="left">A pattern for matching the event. Only characters, dots and stars are allowed in the pattern. The pattern can be an exact match or use wildcards:</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">* dot (.) : matches a dot literally</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">* star (*) : matches 0 or more characters, excluding dots</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">* double star (**): matches 0 or more characters, including dots</td>
</tr>
<tr class="odd">
<td align="left">cond</td>
<td align="left">A condition that must also be satisfied for the event handler to trigger. Note that Java expressions should not contain double quotes (since they will conflict with the attributes quotes). Use single quotes instead, and they will be replaced in the compilation process.</td>
</tr>
</tbody>
</table>
<p>Two special variables are created that you can access in both the &quot;cond&quot; attribute and the event handler actions:</p>
<table>
<tbody>
<tr class="odd">
<td align="left">event</td>
<td align="left">The event object, which is of type Record (see further down and the Javadoc). This is useful if you want to check the event parameters.</td>
</tr>
<tr class="even">
<td align="left">count</td>
<td align="left">The number of time this event handler has triggered while being in this state. It is set to 1 the first time the event handler matches (or is about to match), and then reset if the flow transitions with a &lt;goto&gt;.</td>
</tr>
</tbody>
</table>
<h3 id="event-handler-onentry">Event handler: &lt;onentry&gt;</h3>
<p>Actions in the &lt;onentry&gt; event handler are executed when the state is entered, either through &lt;call&gt; or &lt;goto&gt;, or when the &lt;reentry&gt; action is issued.</p>
<p>You can also access the &quot;count&quot; variable, as described above.</p>
<h3 id="event-handler-onexit">Event handler: &lt;onexit&gt;</h3>
<p>Actions in the &lt;onexit&gt; event handler are executed when there is a transition to another state (either through &lt;call&gt; or &lt;goto&gt;). <strong>Note</strong>: The &lt;onexit&gt; event handler should not contain any instructions that changes the flow execution or that will take up time, such as &lt;call&gt;, &lt;goto&gt; or &lt;wait&gt;.</p>
<h3 id="event-handler-ontime">Event handler: &lt;ontime&gt;</h3>
<p>The &lt;ontime&gt; event handler triggers actions after some time has passed. It can take one of two attributes:</p>
<table>
<tbody>
<tr class="odd">
<td align="left">interval</td>
<td align="left">Triggers several times at a certain time interval (in milliseconds). The time interval can either be a random interval, for example &quot;1000-3000&quot; (the time changes after each trigger), or a fixed interval, such as &quot;2000&quot;.</td>
</tr>
<tr class="even">
<td align="left">afterentry</td>
<td align="left">Triggers after some time has passed since the state was entered (unless the state is exited before that). Expressed in milliseconds, for example &quot;2500&quot;.</td>
</tr>
</tbody>
</table>
<p>You can also access the &quot;count&quot; variable, as described above.</p>
<h3 id="action-goto">Action: &lt;goto&gt;</h3>
<p>Issues an immediate transition to another state. Thus, there is no point in having more actions afterwards in the same event handler, which means that &lt;goto&gt; should always be placed last. The name of the target state is given with the state attribute. You can also provide any number of custom parameters using the p: namespace prefix (iristk.flow.param), however these must match the parameters that the target state accepts.</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;state</span><span class="ot"> id=</span><span class="st">&quot;Start&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;onentry&gt;</span>
        <span class="kw">&lt;goto</span><span class="ot"> state=</span><span class="st">&quot;SayHello&quot;</span><span class="ot"> p:name=</span><span class="st">&quot;&#39;Peter&#39;&quot;</span><span class="kw">/&gt;</span>
    <span class="kw">&lt;/onentry&gt;</span>
<span class="kw">&lt;/state&gt;</span>

<span class="kw">&lt;state</span><span class="ot"> id=</span><span class="st">&quot;SayHello&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;param</span><span class="ot"> name=</span><span class="st">&quot;name&quot;</span><span class="ot"> type=</span><span class="st">&quot;String&quot;</span><span class="kw">/&gt;</span>
    <span class="kw">&lt;onentry&gt;</span>
        <span class="kw">&lt;send</span><span class="ot"> event=</span><span class="st">&quot;action.speech&quot;</span><span class="ot"> p:text=</span><span class="st">&quot;&#39;Hello &#39; + name&quot;</span><span class="kw">/&gt;</span>
    <span class="kw">&lt;/onentry&gt;</span>
<span class="kw">&lt;/state&gt;</span></code></pre>
<p>This example will make the system say &quot;Hello Peter&quot;.</p>
<h3 id="action-call-return">Action: &lt;call&gt;, &lt;return&gt;</h3>
<p>Issues a call to another state (similar to calling a function in any programming language) as part of an execution and then continue the execution when the called state issues a &lt;return&gt;.</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;state</span><span class="ot"> id=</span><span class="st">&quot;Start&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;onentry&gt;</span>
        <span class="kw">&lt;call</span><span class="ot"> state=</span><span class="st">&quot;SayHello&quot;</span><span class="ot"> p:name=</span><span class="st">&quot;&#39;Peter&#39;&quot;</span><span class="kw">/&gt;</span>
        <span class="kw">&lt;call</span><span class="ot"> state=</span><span class="st">&quot;SayHello&quot;</span><span class="ot"> p:name=</span><span class="st">&quot;&#39;Susan&#39;&quot;</span><span class="kw">/&gt;</span>
    <span class="kw">&lt;/onentry&gt;</span>
<span class="kw">&lt;/state&gt;</span>

<span class="kw">&lt;state</span><span class="ot"> id=</span><span class="st">&quot;SayHello&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;param</span><span class="ot"> name=</span><span class="st">&quot;name&quot;</span><span class="ot"> type=</span><span class="st">&quot;String&quot;</span><span class="kw">/&gt;</span>
    <span class="kw">&lt;onentry&gt;</span>
        <span class="kw">&lt;send</span><span class="ot"> event=</span><span class="st">&quot;action.speech&quot;</span><span class="ot"> p:text=</span><span class="st">&quot;&#39;Hello &#39; + name&quot;</span><span class="kw">/&gt;</span>
    <span class="kw">&lt;/onentry&gt;</span>
    <span class="kw">&lt;onevent</span><span class="ot"> name=</span><span class="st">&quot;monitor.speech.end&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;return/&gt;</span>
    <span class="kw">&lt;/onevent&gt;</span>
<span class="kw">&lt;/state&gt;</span></code></pre>
<p>When a state is called, the calling state will pause. In the example above, the SayHello state will send an &quot;action.speech&quot; event to the speech synthesizer. When the speech synthesis is done, the state will catch the &quot;monitor.speech.end&quot; event and issue a &lt;return&gt; to the calling state (Start), which will then continue with the next action (another call to SayHello). Thus, the system will first say &quot;Hello Peter&quot; and then &quot;Hello Susan&quot;.</p>
<p>It is also possible to raise an event when the flow returns. This is similar to how functions in most programming languages can return a value:</p>
<pre class="sourceCode xml"><code class="sourceCode xml">// Return a simple event which will trigger event handlers in the calling state
<span class="kw">&lt;return</span><span class="ot"> event=</span><span class="st">&quot;speech.done&quot;</span><span class="kw">/&gt;</span>
// Set event parameters
<span class="kw">&lt;return</span><span class="ot"> event=</span><span class="st">&quot;speech.done&quot;</span><span class="ot"> p:text=</span><span class="st">&quot;...&quot;</span><span class="kw">/&gt;</span>
// Copy event parameters (see <span class="kw">&lt;raise&gt;</span> and <span class="kw">&lt;send&gt;</span> below)
<span class="kw">&lt;return</span><span class="ot"> event=</span><span class="st">&quot;speech.done&quot;</span><span class="ot"> copy=</span><span class="st">&quot;event&quot;</span><span class="kw">/&gt;</span></code></pre>
<h3 id="action-send-raise">Action: &lt;send&gt;, &lt;raise&gt;</h3>
<p>The &lt;send&gt; action will send a global event to the IrisSystem. The &lt;raise&gt; action will raise a local event in the flow. The name of the event is given with the event attribute. Just like with &lt;goto&gt;, parameters are specified using the p: namespace prefix. Examples:</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;send</span><span class="ot"> event=</span><span class="st">&quot;action.speech&quot;</span><span class="ot"> p:text=</span><span class="st">&quot;&#39;hello&#39;&quot;</span><span class="kw">/&gt;</span>
<span class="kw">&lt;raise</span><span class="ot"> event=</span><span class="st">&quot;chess.move.user&quot;</span><span class="kw">/&gt;</span></code></pre>
<p>Note: the parameter hello is enclosed in single quotes. If it were not, it would be treated as a variable. Note also that when &lt;raise&gt; is used, the event will not be placed on the event queue. Instead, relevant event handlers will be triggered <strong>immediately</strong>, before any more actions are taken.</p>
<p>In both &lt;send&gt; and &lt;raise&gt;, you can also copy all parameters of another event:</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;onevent</span><span class="ot"> name=</span><span class="st">&quot;sense.speech.rec.final&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;raise</span><span class="ot"> event=</span><span class="st">&quot;my.speech&quot;</span><span class="ot"> copy=</span><span class="st">&quot;event&quot;</span><span class="ot"> p:text=</span><span class="st">&quot;&#39;hello&#39;&quot;</span><span class="kw">/&gt;</span>
<span class="kw">&lt;/onevent&gt;</span></code></pre>
<p>This will copy all parameters of the &quot;event&quot; object and add (or overwrite) the parameter &quot;text&quot;.</p>
<p>In both &lt;send&gt; and &lt;raise&gt;, it is also possible to delay the dispatch of the event with the following attributes:</p>
<table>
<tbody>
<tr class="odd">
<td align="left">delay</td>
<td align="left">The number of milliseconds that should pass before the event is dispatched.</td>
</tr>
<tr class="even">
<td align="left">forgetOnExit</td>
<td align="left">Can be set to true (default is false), which means that the event will not be dispatched if the state is exited before the delay time has passed.</td>
</tr>
</tbody>
</table>
<h3 id="action-reentry">Action: &lt;reentry&gt;</h3>
<p>The &lt;reentry&gt; tag will make a reentry into the current state, triggering the &lt;onentry&gt; event handler again.</p>
<h3 id="action-if-else-elseif">Action: &lt;if&gt;, &lt;else&gt;, &lt;elseif&gt;</h3>
<p>Follow the following pattern to create an if-then-else construction:</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;if</span><span class="ot"> cond=</span><span class="st">&quot;test == 1&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;goto</span><span class="ot"> state=</span><span class="st">&quot;state1&quot;</span><span class="kw">/&gt;</span>
<span class="kw">&lt;elseif</span><span class="ot"> cond=</span><span class="st">&quot;test == 2&quot;</span><span class="kw">/&gt;</span>
    <span class="kw">&lt;goto</span><span class="ot"> state=</span><span class="st">&quot;state2&quot;</span><span class="kw">/&gt;</span>
<span class="kw">&lt;elseif</span><span class="ot"> cond=</span><span class="st">&quot;test == 3&quot;</span><span class="kw">/&gt;</span>
    <span class="kw">&lt;goto</span><span class="ot"> state=</span><span class="st">&quot;state3&quot;</span><span class="kw">/&gt;</span>
<span class="kw">&lt;else/&gt;</span>
    <span class="kw">&lt;goto</span><span class="ot"> state=</span><span class="st">&quot;state4&quot;</span><span class="kw">/&gt;</span>
<span class="kw">&lt;/if&gt;</span></code></pre>
<h3 id="action-randomblock">Action: &lt;random&gt;,&lt;block&gt;</h3>
<p>The &lt;random&gt; tag will make a random choice between one of the children and perform that action. In this example, the system will randomly go to either state1, state2 or state3.</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;random&gt;</span>
    <span class="kw">&lt;goto</span><span class="ot"> state=</span><span class="st">&quot;state1&quot;</span><span class="kw">/&gt;</span>
    <span class="kw">&lt;goto</span><span class="ot"> state=</span><span class="st">&quot;state2&quot;</span><span class="kw">/&gt;</span>
    <span class="kw">&lt;goto</span><span class="ot"> state=</span><span class="st">&quot;state3&quot;</span><span class="kw">/&gt;</span>
<span class="kw">&lt;/random&gt;</span></code></pre>
<p>How the random choice is made can also be controlled by providing an attribute called &quot;model&quot; to the &lt;random&gt; tag. The attribute can have the following values:</p>
<table>
<tbody>
<tr class="odd">
<td align="left">deck</td>
<td align="left">The options are treated as a deck of cards that is randomized the first time. Then the order of the cards is preserved across iterations.</td>
</tr>
<tr class="even">
<td align="left">deck_reshuffle</td>
<td align="left">Same as &quot;deck&quot;, but the deck is reshuffled after each iteration (i.e. when the deck is empty).</td>
</tr>
<tr class="odd">
<td align="left">deck_reshuffle_norepeat (default)</td>
<td align="left">Same as &quot;deck_reshuffle&quot;, but it is also guaranteed that there will be no repetitions when the deck is reshuffled.</td>
</tr>
<tr class="even">
<td align="left">dice</td>
<td align="left">Completely random choice with no memory.</td>
</tr>
<tr class="odd">
<td align="left">dice_norepeat</td>
<td align="left">Same as &quot;dice&quot;, but it is also guaranteed that there will be no repetitions.</td>
</tr>
<tr class="even">
<td align="left">nonrandom</td>
<td align="left">Like a &quot;deck&quot; but with no randomization (the options are taken in the order they are provided).</td>
</tr>
</tbody>
</table>
<p>To make a random choice between sequences of actions, or to manipulate the random choice, use &lt;block&gt; tags directly under &lt;random&gt; to group them. In the following example, the system will either go to state1 or first call state2 and then go to state3:</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;random&gt;</span>
    <span class="kw">&lt;block&gt;</span>
        <span class="kw">&lt;goto</span><span class="ot"> state=</span><span class="st">&quot;state1&quot;</span><span class="kw">/&gt;</span>
    <span class="kw">&lt;/block&gt;</span>
    <span class="kw">&lt;block&gt;</span>
        <span class="kw">&lt;call</span><span class="ot"> state=</span><span class="st">&quot;state2&quot;</span><span class="kw">/&gt;</span>
        <span class="kw">&lt;goto</span><span class="ot"> state=</span><span class="st">&quot;state3&quot;</span><span class="kw">/&gt;</span>
    <span class="kw">&lt;/block&gt;</span>
<span class="kw">&lt;/random&gt;</span></code></pre>
<p>The &lt;block&gt; tag can have two optional attributes:</p>
<table>
<tbody>
<tr class="odd">
<td align="left">weight</td>
<td align="left">An integer that puts a weight on the block for the random choice. For example, if one block has weight 1 and another weight 2, the second block will be chosen two times out of three.</td>
</tr>
<tr class="even">
<td align="left">cond</td>
<td align="left">A guard condition (see &lt;catch&gt; above) that must evaluate to true for the block to be a candidate for selection.</td>
</tr>
</tbody>
</table>
<h3 id="action-exec">Action: &lt;exec&gt;</h3>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;exec&gt;</span>System.exit(0)<span class="kw">&lt;/exec&gt;</span></code></pre>
<p>The &lt;exec&gt; tag can contain any Java code that is to be executed. It does not have to end with &quot;;&quot;, but you must use &quot;;&quot; to separate multiple instructions.</p>
<h3 id="action-propagate">Action: &lt;propagate&gt;</h3>
<p>The &lt;propagate&gt; tag will instruct the FlowModule to continue to match the event against other event handlers (i.e. it is not consumed).</p>
<h3 id="action-wait">Action: &lt;wait&gt;</h3>
<p>Pauses the flow execution. During the pause, events are still checked for. Thus, if an event causes a state transition, the pause will be aborted.</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="co">&lt;!-- Pause 2000 milliseconds --&gt;</span>
<span class="kw">&lt;wait</span><span class="ot"> msec=</span><span class="st">&quot;2000&quot;</span><span class="kw">/&gt;</span></code></pre>
<h3 id="action-log">Action: &lt;log&gt;</h3>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;log&gt;</span>Log this line<span class="kw">&lt;/log&gt;</span></code></pre>
<p>Logs the text content. Default is to send it to standard out, but this can be changed to for example a file:</p>
<pre class="sourceCode java"><code class="sourceCode java">flowModule.<span class="fu">setLogStream</span>(<span class="kw">new</span> FileOutputStream(<span class="st">&quot;log.txt&quot;</span>));</code></pre>
<p>Note that if you want to log an expression, you have to use the &lt;expr&gt; tag (see further down):</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;log&gt;</span>The time is now <span class="kw">&lt;expr&gt;</span>System.currentTimeMillis()<span class="kw">&lt;/expr&gt;&lt;/log&gt;</span></code></pre>
<h3 id="parameters">Parameters</h3>
<p>As seen above, parameters (in &lt;call&gt;, &lt;goto&gt;, &lt;send&gt;, etc) are provided with the p: namespace prefix (which should be mapped to iristk.flow.param). It is important to note that if the value is not quoted (again, with single quotes), it is treated as a Java expression:</p>
<pre class="sourceCode java"><code class="sourceCode java">p:param=<span class="st">&quot;text&quot;</span>   <span class="co">// The variable text</span>
p:param=<span class="st">&quot;&#39;text&#39;&quot;</span> <span class="co">// The string &quot;text&quot;</span>
p:param=<span class="st">&quot;true&quot;</span>   <span class="co">// The boolean value true</span>
p:param=<span class="st">&quot;&#39;true&#39;&quot;</span> <span class="co">// The string &quot;true&quot;</span>
p:param=<span class="st">&quot;0&quot;</span>      <span class="co">// The integer value 0</span>
p:param=<span class="st">&quot;&#39;0&#39;&quot;</span>    <span class="co">// The string &quot;0&quot;</span></code></pre>
<p>For convenience, there is a special parameter named &quot;text&quot; of the type String that can be provided as a XML text child (or as an arbitrary XML structure). Thus, the following two expressions are equal:</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;call</span><span class="ot"> state=</span><span class="st">&quot;Speaking&quot;</span><span class="kw">&gt;</span>Hello there<span class="kw">&lt;/call&gt;</span>
<span class="kw">&lt;call</span><span class="ot"> state=</span><span class="st">&quot;Speaking&quot;</span><span class="ot"> p:text=</span><span class="st">&quot;&#39;Hello there&#39;&quot;</span><span class="kw">/&gt;</span></code></pre>
<h3 id="string-expressions-expr-str-select">String expressions: &lt;expr&gt;, &lt;str&gt;, &lt;select&gt;</h3>
<p>For the XML text child, it is also possible to insert expressions in the string using the &lt;expr&gt; tag. These two expressions are equal and will result in &quot;One plus one is 2&quot;:</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;call</span><span class="ot"> state=</span><span class="st">&quot;Speaking&quot;</span><span class="kw">&gt;</span>One plus one is <span class="kw">&lt;expr&gt;</span>1 + 1<span class="kw">&lt;/expr&gt;&lt;/call&gt;</span>
<span class="kw">&lt;call</span><span class="ot"> state=</span><span class="st">&quot;Speaking&quot;</span><span class="ot"> p:text=</span><span class="st">&quot;&#39;One plus one is &#39; + (1 + 1)&quot;</span><span class="kw">/&gt;</span></code></pre>
<p>You can also make a sub-string conditional using the &lt;str&gt; tag:</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;call</span><span class="ot"> state=</span><span class="st">&quot;Speaking&quot;</span><span class="kw">&gt;</span>
    That was <span class="kw">&lt;str</span><span class="ot"> cond=</span><span class="st">&quot;score &gt; 100&quot;</span><span class="kw">&gt;</span>very<span class="kw">&lt;/str&gt;</span> good
<span class="kw">&lt;/call&gt;</span></code></pre>
<p>With the &lt;select&gt; tag, you can create if-then-else constructions:</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;call</span><span class="ot"> state=</span><span class="st">&quot;Speaking&quot;</span><span class="kw">&gt;</span>
    You have <span class="kw">&lt;expr&gt;</span>n<span class="kw">&lt;/expr&gt;</span> 
    <span class="kw">&lt;select&gt;</span>
        <span class="kw">&lt;str</span><span class="ot"> cond=</span><span class="st">&quot;n==1&quot;</span><span class="kw">&gt;</span>point<span class="kw">&lt;/str&gt;</span> 
        <span class="kw">&lt;str&gt;</span>point<span class="kw">&lt;/str&gt;</span>
    <span class="kw">&lt;/select&gt;</span>
<span class="kw">&lt;/call&gt;</span></code></pre>
<p>You can also make random choices by adding the attribute &quot;choice&quot; to the &lt;select&gt; tag:</p>
<pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;call</span><span class="ot"> state=</span><span class="st">&quot;Speaking&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;select</span><span class="ot"> choice=</span><span class="st">&quot;random&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;str&gt;</span>Hi<span class="kw">&lt;/str&gt;</span>
        <span class="kw">&lt;str&gt;</span>Hello<span class="kw">&lt;/str&gt;</span>
    <span class="kw">&lt;/select&gt;</span>
    there
<span class="kw">&lt;/call&gt;</span></code></pre>
<p>You can also add conditions (cond=&quot;...&quot;) to the &lt;str&gt; tags in these random expressions, if you want to block certain possible outcomes.</p>
<p><strong>Note</strong>: Don't confuse &lt;select choice=&quot;random&quot;&gt; with the &lt;random&gt; tag. The latter is not used in text positions, but rather to choose between a set of actions.</p>
<h3 id="events-and-records">Events and Records</h3>
<p>When an event is caught in an &lt;onevent&gt; handler, a special object &quot;event&quot; is provided and can be checked in for example the &quot;cond&quot; expression. This object is of type iristk.system.Event, which in turn extends the iristk.util.Record class. This is essentially a map of key-value pairs (much like any java Map). However, it supports a convenient way of accessing nestled values deep in the hierarchy by using colon (:) notation:</p>
<pre class="sourceCode java"><code class="sourceCode java">event:text           <span class="co">// Access the field &quot;text&quot;</span>
event:sem:direction  <span class="co">// Access the nestled field &quot;sem:direction&quot;</span>
event:sem:(field)    <span class="co">// Evaluates the expression &quot;field&quot; and uses it for accessing</span></code></pre>
<p>If the event/record does not contain the requested field, null will be returned. Otherwise, a value of type Object will be returned. If you need to treat the value as some specific type (e.g. to do a numeric comparison using &gt;), you need to cast it, otherwise the Java compiler will object. The flow compiler allows for a set of static methods for easily casting values and even converting them if necessary (for example the string &quot;2&quot; to the integer 2):</p>
<pre class="sourceCode java"><code class="sourceCode java"><span class="fu">asString</span>(event:text)
<span class="fu">asBoolean</span>(event:check)   
<span class="fu">asFloat</span>(event:length)
<span class="fu">asInteger</span>(event:age)
<span class="fu">asRecord</span>(event:sem)</code></pre>
<p>If the value is null, these methods will also return null (except for asBoolean, see below), otherwise they will do their best to return a value of the right type (converting strings to numbers, etc).</p>
<p>asBoolean can be very useful in cond-expressions. It will return the following depending on the parameter:</p>
<ul>
<li>Boolean: same</li>
<li>List: false if empty, true otherwise</li>
<li>Number: false if 0, true otherwise</li>
<li>String: false if &quot;false&quot; (case insensitive), true otherwise</li>
<li>Other object: false if null, true otherwise</li>
</ul>
<p>You can also provide a default value as a second argument in case the value is null (i.e. no such field exists):</p>
<pre class="sourceCode java"><code class="sourceCode java"><span class="fu">asString</span>(event:sem:direction, <span class="st">&quot;none&quot;</span>)</code></pre>
<p>You can also check whether a field is present or not, which can be very useful in cond-expressions:</p>
<pre class="sourceCode java"><code class="sourceCode java">event?:sem:direction  <span class="co">// Check whether the nestled field &quot;sem:direction&quot; is present</span>
event?:text           <span class="co">// Check whether the field &quot;text&quot; is present</span></code></pre>
<p>In &lt;exec&gt; statements, you can also manipulate events/records with these operators:</p>
<pre class="sourceCode java"><code class="sourceCode java"><span class="co">// Puts the string &quot;left&quot; in the field &quot;direction&quot; of the record nestled under &quot;sem&quot;, </span>
<span class="co">// creating this nestled record if necessary</span>
newEvent:sem:direction = <span class="st">&quot;left&quot;</span>    
<span class="co">// Copies all fields of &quot;event&quot; to &quot;newEvent&quot;</span>
newEvent := event                  </code></pre>
<p>On the Java side, records can be created and manipulated like this:</p>
<pre class="sourceCode java"><code class="sourceCode java"><span class="co">// Create a record</span>
Record person = <span class="kw">new</span> <span class="fu">Record</span>()
<span class="co">// Store the Integer 30 in the field &quot;age&quot; of the record &quot;person&quot;</span>
person.<span class="fu">put</span>(<span class="st">&quot;age&quot;</span>, <span class="dv">30</span>)
<span class="co">// Store the value 60 in field &quot;age&quot; of the sub-record that is located </span>
<span class="co">// in the field &quot;father&quot; of the record &quot;person&quot;. If the field &quot;father&quot; does </span>
<span class="co">// not already contain a Record, it will be created.</span>
person.<span class="fu">put</span>(<span class="st">&quot;father:age&quot;</span>, <span class="dv">60</span>)
<span class="co">// Access the value of the field &quot;age&quot; (as an Object)</span>
person.<span class="fu">get</span>(<span class="st">&quot;age&quot;</span>)
<span class="co">// Access the value of the field &quot;age&quot; as an Integer (null if there is no such value)</span>
person.<span class="fu">getInteger</span>(<span class="st">&quot;age&quot;</span>)
<span class="co">// Access the value of the field &quot;age&quot; as an Integer with default value</span>
person.<span class="fu">getInteger</span>(<span class="st">&quot;age&quot;</span>, <span class="dv">0</span>)
<span class="co">// Access a nestled value</span>
person.<span class="fu">getInteger</span>(<span class="st">&quot;father:age&quot;</span>, <span class="dv">0</span>)
<span class="co">// Check if a value is present</span>
person.<span class="fu">has</span>(<span class="st">&quot;age&quot;</span>);
<span class="co">// Kleen stars (*) are allowed in the has() method.</span>
person.<span class="fu">has</span>(<span class="st">&quot;*:age&quot;</span>)</code></pre>
		
		</div>

		<div class="large-4 columns">
			<h3>Guide to IrisTK</h3>
			
			<div class="section-container accordion" data-section="accordion">
				
				<section><p class="title" data-section-title><a href="#">Getting started</a></p><div class="content" data-section-content><ul class="side-nav"><li><a href="overview.html">Overview of IrisTK</a></li><li><a href="installation.html">Installation</a></li><li><a href="develop_in_eclipse.html">Develop in Eclipse</a></li><li><a href="tutorial_first_app.html">Tutorial 1: Your first application</a></li><li><a href="tutorial_sitint.html">Tutorial 2: Situated interaction</a></li><li><a href="tutorial_semantics.html">Tutorial 3: Semantics and dialog</a></li></ul></div></section><section><p class="title" data-section-title><a href="#">System, modules and events</a></p><div class="content" data-section-content><ul class="side-nav"><li><a href="system_overview.html">System and Events</a></li><li><a href="events.html">Standardized Events</a></li><li><a href="creating_new_modules.html">Creating new modules</a></li><li><a href="distributed_systems.html">Distributed systems</a></li></ul></div></section><section class="active"><p class="title" data-section-title><a href="#">IrisFlow</a></p><div class="content" data-section-content><ul class="side-nav"><li><a href="irisflow_overview.html">IrisFlow overview</a></li><li class="active"><a href="irisflow_reference.html">IrisFlow reference</a></li><li><a href="irisflow_advanced.html">Advanced topics</a></li></ul></div></section><section><p class="title" data-section-title><a href="#">Reference</a></p><div class="content" data-section-content><ul class="side-nav"><li><a href="microphones.html">Microphones</a></li><li><a href="furhat.html">Furhat robot head</a></li><li><a href="gestures.html">Facial gestures</a></li><li><a href="cereproc.html">Cereproc TTS</a></li><li><a href="../javadoc/index.html">Javadoc</a></li></ul></div></section>		
			  
			</div>
			
		</div>
	</div>
	
	
	<div class="row">
		<div class="large-12 columns">
			<hr/>
			<p>Copyright &copy; Gabriel Skantze, 2013-</p>
		</div>
	</div>

  <script>
  document.write('<script src=' +
  ('__proto__' in {} ? 'js/vendor/zepto' : 'js/vendor/jquery') +
  '.js><\/script>')
  </script>
  
  <script src="js/foundation.min.js"></script>

  <script src="js/foundation/foundation.js"></script>
  
  <script src="js/foundation/foundation.alerts.js"></script>
  
  <script src="js/foundation/foundation.clearing.js"></script>
  
  <script src="js/foundation/foundation.cookie.js"></script>
  
  <script src="js/foundation/foundation.dropdown.js"></script>
  
  <script src="js/foundation/foundation.forms.js"></script>
  
  <script src="js/foundation/foundation.joyride.js"></script>
  
  <script src="js/foundation/foundation.magellan.js"></script>
  
  <script src="js/foundation/foundation.orbit.js"></script>
  
  <script src="js/foundation/foundation.reveal.js"></script>
  
  <script src="js/foundation/foundation.section.js"></script>
  
  <script src="js/foundation/foundation.tooltips.js"></script>
  
  <script src="js/foundation/foundation.topbar.js"></script>
  
  <script src="js/foundation/foundation.interchange.js"></script>
  
  <script src="js/foundation/foundation.placeholder.js"></script>
  
  <script src="js/foundation/foundation.abide.js"></script>

  
  
  <script>
    $(document).foundation();
  </script>
</body>
</html>